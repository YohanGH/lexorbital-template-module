#!/usr/bin/env sh

# Trigger: After git merge or git pull
# Goal: Remind to run `pnpm install` if dependencies have changed

# Exit on error, undefined variables, and pipe failures
set -euo pipefail

# Verify we are in a git repository
if ! git rev-parse --git-dir > /dev/null 2>&1; then
  echo "âŒ Error: Not in a git repository" >&2
  exit 1
fi

echo "ğŸ”„ Post-merge automation..."

# Check if ORIG_HEAD exists (may not exist on first merge)
if [ ! -f "$(git rev-parse --git-dir)/ORIG_HEAD" ]; then
  echo "â„¹ï¸  No previous HEAD found - skipping dependency check"
  echo "âœ… Post-merge completed!"
  exit 0
fi

# Simple dependency check
# Check if package.json or package-lock.json files were modified
if git diff-tree -r --name-only --no-commit-id ORIG_HEAD HEAD 2>/dev/null \
  | grep -E "package(-lock)?\.json$" >/dev/null 2>&1; then
  echo "ğŸ“¦ Dependencies may have changed - consider running 'pnpm install'"
fi

echo "âœ… Post-merge completed!"
